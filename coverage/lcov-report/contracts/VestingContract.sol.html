<!doctype html>
<html lang="en">
<head>
    <title>Code coverage report for contracts/VestingContract.sol</title>
    <meta charset="utf-8" />
    <link rel="stylesheet" href="../prettify.css" />
    <link rel="stylesheet" href="../base.css" />
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <style type='text/css'>
        .coverage-summary .sorter {
            background-image: url(../sort-arrow-sprite.png);
        }
    </style>
</head>
<body>
<div class='wrapper'>
  <div class='pad1'>
    <h1>
      <a href="../index.html">all files</a> / <a href="index.html">contracts/</a> VestingContract.sol
    </h1>
    <div class='clearfix'>
      <div class='fl pad1y space-right2'>
        <span class="strong">98.33% </span>
        <span class="quiet">Statements</span>
        <span class='fraction'>59/60</span>
      </div>
      <div class='fl pad1y space-right2'>
        <span class="strong">75% </span>
        <span class="quiet">Branches</span>
        <span class='fraction'>27/36</span>
      </div>
      <div class='fl pad1y space-right2'>
        <span class="strong">100% </span>
        <span class="quiet">Functions</span>
        <span class='fraction'>15/15</span>
      </div>
      <div class='fl pad1y space-right2'>
        <span class="strong">98.36% </span>
        <span class="quiet">Lines</span>
        <span class='fraction'>60/61</span>
      </div>
    </div>
  </div>
  <div class='status-line high'></div>
<pre><table class="coverage">
<tr><td class="line-count quiet">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
74
75
76
77
78
79
80
81
82
83
84
85
86
87
88
89
90
91
92
93
94
95
96
97
98
99
100
101
102
103
104
105
106
107
108
109
110
111
112
113
114
115
116
117
118
119
120
121
122
123
124
125
126
127
128
129
130
131
132
133
134
135
136
137
138
139
140
141
142
143
144
145
146
147
148
149
150
151
152
153
154
155
156
157
158
159
160
161
162
163
164
165
166
167
168
169
170
171
172
173
174
175
176
177
178
179
180
181
182
183
184
185
186
187
188
189
190
191
192
193
194
195
196
197
198
199
200
201
202
203
204
205
206
207
208
209
210
211
212
213
214
215
216
217
218
219
220
221
222
223
224
225
226
227
228
229
230
231
232
233</td><td class="line-coverage quiet"><span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">50×</span>
<span class="cline-any cline-yes">48×</span>
<span class="cline-any cline-yes">48×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">110×</span>
<span class="cline-any cline-yes">110×</span>
<span class="cline-any cline-yes">110×</span>
<span class="cline-any cline-yes">110×</span>
<span class="cline-any cline-yes">110×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">73×</span>
<span class="cline-any cline-yes">71×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">69×</span>
<span class="cline-any cline-yes">69×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">69×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">67×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">67×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">67×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">67×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">67×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">67×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">55×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">3×</span>
<span class="cline-any cline-yes">1×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">10×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">4×</span>
<span class="cline-any cline-yes">4×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">16×</span>
<span class="cline-any cline-yes">16×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">12×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">21×</span>
<span class="cline-any cline-yes">21×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">56×</span>
<span class="cline-any cline-yes">56×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">54×</span>
<span class="cline-any cline-yes">54×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">44×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">44×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">44×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">44×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">44×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1×</span>
<span class="cline-any cline-yes">1×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">67×</span>
<span class="cline-any cline-yes">67×</span>
<span class="cline-any cline-yes">67×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">3×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">66×</span>
<span class="cline-any cline-yes">66×</span>
<span class="cline-any cline-yes">66×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">63×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">63×</span>
<span class="cline-any cline-yes">31×</span>
<span class="cline-any cline-yes">31×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">32×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">32×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">32×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">32×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span></td><td class="text"><pre class="prettyprint lang-js">pragma solidity ^0.5.16;
&nbsp;
import "@openzeppelin/contracts/math/SafeMath.sol";
import "@openzeppelin/contracts/utils/ReentrancyGuard.sol";
import "./IERC20.sol";
import "./VestingDepositAccount.sol";
&nbsp;
contract VestingContract is ReentrancyGuard {
    using SafeMath for uint256;
&nbsp;
    event ScheduleCreated(address indexed _beneficiary, uint256 indexed _amount);
&nbsp;
    event DrawDown(address indexed _beneficiary, uint256 indexed _amount, uint256 indexed _time);
&nbsp;
    struct ScheduleConfig {
        uint256 start;
        uint256 end;
        uint256 cliffDuration;
    }
&nbsp;
    struct Schedule {
        string scheduleConfigId;
        uint256 amount;
        uint256 drawDownRate;
        VestingDepositAccount depositAccount;
    }
&nbsp;
    address public owner;
&nbsp;
    // Vested address to its schedule
    mapping(string =&gt; ScheduleConfig) public vestingScheduleConfigs;
    mapping(address =&gt; Schedule) public vestingSchedule;
    mapping(address =&gt; uint256) public totalDrawn;
    mapping(address =&gt; uint256) public lastDrawnAt;
&nbsp;
    IERC20 public token;
&nbsp;
    // All durations are based in number days
    uint256 public constant PERIOD_ONE_DAY_IN_SECONDS = 1 days;
&nbsp;
    constructor(IERC20 _token) public {
        require(address(_token) != address(0));
        token = _token;
        owner = msg.sender;
    }
&nbsp;
    function createVestingScheduleConfig(string calldata _scheduleConfigId, uint256 _start, uint256 _durationInDays, uint256 _cliffDurationInDays) external {
        <span class="missing-if-branch" title="else path not taken" >E</span>require(msg.sender == owner, "VestingContract::createVestingScheduleConfig: Only owner");
        <span class="missing-if-branch" title="else path not taken" >E</span>require(_durationInDays &gt; 0, "VestingContract::createVestingScheduleConfig: Duration cannot be empty");
        uint256 _durationInSecs = _durationInDays.mul(PERIOD_ONE_DAY_IN_SECONDS);
        uint256 _cliffDurationInSecs = _cliffDurationInDays.mul(PERIOD_ONE_DAY_IN_SECONDS);
        vestingScheduleConfigs[_scheduleConfigId] = ScheduleConfig({
            start: _start,
            end: _start.add(_durationInSecs),
            cliffDuration: _cliffDurationInSecs
        });
    }
&nbsp;
    function createVestingSchedule(string calldata _scheduleConfigId, address _beneficiary, uint256 _amount) external returns (bool) {
        require(_beneficiary != address(0), "VestingContract::createVestingSchedule: Beneficiary cannot be empty");
        require(_amount &gt; 0, "VestingContract::createVestingSchedule: Amount cannot be empty");
&nbsp;
        ScheduleConfig memory scheduleConfig = vestingScheduleConfigs[_scheduleConfigId];
        <span class="missing-if-branch" title="else path not taken" >E</span>require(scheduleConfig.start &gt; 0, "VestingContract::createVestingSchedule: Schedule configuration does not exist");
&nbsp;
        // Ensure one per address
        require(vestingSchedule[_beneficiary].amount == 0, "VestingContract::createVestingSchedule: Schedule already in flight");
&nbsp;
        // Set up the vesting deposit account for the _beneficiary
        VestingDepositAccount depositAccount = new VestingDepositAccount(address(token), address(this), _beneficiary);
&nbsp;
        // Create schedule
        vestingSchedule[_beneficiary] = Schedule({
            scheduleConfigId: _scheduleConfigId,
            amount : _amount,
            drawDownRate : _amount.div(scheduleConfig.end.sub(scheduleConfig.start)),
            depositAccount : depositAccount
        });
&nbsp;
        // Vest the tokens into the deposit account and delegate to the beneficiary
        <span class="missing-if-branch" title="else path not taken" >E</span>require(token.transferFrom(msg.sender, address(depositAccount), _amount), "VestingContract::createVestingSchedule: Unable to transfer tokens to VDA");
&nbsp;
        // ensure beneficiary has voting rights via delegate
        _updateVotingDelegation(_beneficiary);
&nbsp;
        emit ScheduleCreated(_beneficiary, _amount);
&nbsp;
        return true;
    }
&nbsp;
    function drawDown() nonReentrant external returns (bool) {
        return _drawDown(msg.sender);
    }
&nbsp;
    // transfer a schedule in tact to a new beneficiary (for pre-locked up schedules with no beneficiary)
    function updateScheduleBeneficiary(address _currentBeneficiary, address _newBeneficiary) external {
        require(msg.sender == owner, "VestingContract::updateScheduleBeneficiary: Only owner");
        _updateScheduleBeneficiary(_currentBeneficiary, _newBeneficiary);
    }
&nbsp;
    ///////////////
    // Accessors //
    ///////////////
&nbsp;
    // for a given beneficiary
    function tokenBalance() external view returns (uint256) {
        return token.balanceOf(address(vestingSchedule[msg.sender].depositAccount));
    }
&nbsp;
    function depositAccountAddress() external view returns (address) {
        Schedule memory schedule = vestingSchedule[msg.sender];
        return address(schedule.depositAccount);
    }
&nbsp;
    function vestingScheduleForBeneficiary(address _beneficiary)
    external view
    returns (string memory _scheduleConfigId, uint256 _amount, uint256 _totalDrawn, uint256 _lastDrawnAt, uint256 _drawDownRate, uint256 _remainingBalance) {
        Schedule memory schedule = vestingSchedule[_beneficiary];
        return (
        schedule.scheduleConfigId,
        schedule.amount,
        totalDrawn[_beneficiary],
        lastDrawnAt[_beneficiary],
        schedule.drawDownRate,
        schedule.amount.sub(totalDrawn[_beneficiary])
        );
    }
&nbsp;
    function availableDrawDownAmount(address _beneficiary) external view returns (uint256 _amount, uint256 _timeLastDrawn, uint256 _drawDownRate) {
        return _availableDrawDownAmount(_beneficiary);
    }
&nbsp;
    function remainingBalance(address _beneficiary) external view returns (uint256) {
        Schedule memory schedule = vestingSchedule[_beneficiary];
        return schedule.amount.sub(totalDrawn[_beneficiary]);
    }
&nbsp;
    //////////////
    // Internal //
    //////////////
    function _drawDown(address _beneficiary) internal returns (bool) {
        Schedule storage schedule = vestingSchedule[_beneficiary];
        require(schedule.amount &gt; 0, "VestingContract::_drawDown: There is no schedule currently in flight");
&nbsp;
        (uint256 amount,,) = _availableDrawDownAmount(_beneficiary);
        require(amount &gt; 0, "VestingContract::_drawDown: No allowance left to withdraw");
&nbsp;
        // Update last drawn to now
        lastDrawnAt[_beneficiary] = _getNow();
&nbsp;
        // Increase total drawn amount
        totalDrawn[_beneficiary] = totalDrawn[_beneficiary].add(amount);
&nbsp;
        // Issue tokens to beneficiary
        <span class="missing-if-branch" title="else path not taken" >E</span>require(schedule.depositAccount.transferToBeneficiary(amount), "VestingContract::_drawDown: Unable to transfer tokens");
&nbsp;
        emit DrawDown(_beneficiary, amount, _getNow());
&nbsp;
        return true;
    }
&nbsp;
    function _updateScheduleBeneficiary(address _currentBeneficiary, address _newBeneficiary) internal {
        // retrieve existing schedule
        Schedule memory schedule = vestingSchedule[_currentBeneficiary];
        <span class="missing-if-branch" title="else path not taken" >E</span>require(schedule.amount &gt; 0, "VestingContract::_updateScheduleBeneficiary: No schedule exists for current beneficiary");
&nbsp;
        <span class="missing-if-branch" title="else path not taken" >E</span>require(_drawDown(_currentBeneficiary), "VestingContract::_updateScheduleBeneficiary: Unable to drawn down");
&nbsp;
        // transfer the schedule to the new beneficiary
        vestingSchedule[_newBeneficiary] = Schedule({
            scheduleConfigId: schedule.scheduleConfigId,
            amount: schedule.amount.sub(totalDrawn[_currentBeneficiary]),
            drawDownRate: schedule.drawDownRate,
            depositAccount: schedule.depositAccount
            });
&nbsp;
        vestingSchedule[_newBeneficiary].depositAccount.switchBeneficiary(_newBeneficiary);
&nbsp;
        // delete the link between the old beneficiary and the schedule
        delete vestingSchedule[_currentBeneficiary];
    }
&nbsp;
    // note only the beneficiary associated with a vesting schedule can claim voting rights
    function _updateVotingDelegation(address _delegatee) internal {
        Schedule storage schedule = vestingSchedule[_delegatee];
        <span class="missing-if-branch" title="else path not taken" >E</span>require(schedule.amount &gt; 0, "VestingContract::_updateVotingDelegation: There is no schedule currently in flight");
        schedule.depositAccount.updateVotingDelegation(_delegatee);
    }
&nbsp;
    function _getNow() internal view returns (uint256) {
        return block.timestamp;
    }
&nbsp;
    function _availableDrawDownAmount(address _beneficiary) internal view returns (uint256 _amount, uint256 _timeLastDrawn, uint256 _drawDownRate) {
        Schedule memory schedule = vestingSchedule[_beneficiary];
        ScheduleConfig memory scheduleConfig = vestingScheduleConfigs[schedule.scheduleConfigId];
        require(scheduleConfig.start &lt;= _getNow(), "VestingContract::_availableDrawDownAmount: Schedule not started");
&nbsp;
        ///////////////////////
        // Cliff Period      //
        ///////////////////////
&nbsp;
        <span class="missing-if-branch" title="if path not taken" >I</span>if (_getNow() &lt; scheduleConfig.start.add(scheduleConfig.cliffDuration)) {
            // the cliff period has not ended, no tokens to draw down
<span class="cstat-no" title="statement not covered" >            return (0, lastDrawnAt[_beneficiary], 0);</span>
        }
&nbsp;
        ///////////////////////
        // Schedule complete //
        ///////////////////////
&nbsp;
        if (_getNow() &gt; scheduleConfig.end) {
            uint256 amount = schedule.amount.sub(totalDrawn[_beneficiary]);
            return (amount, lastDrawnAt[_beneficiary], 0);
        }
&nbsp;
        ////////////////////////
        // Schedule is active //
        ////////////////////////
&nbsp;
        // Work out when the last invocation was
        uint256 timeLastDrawn = lastDrawnAt[_beneficiary] == 0 ? scheduleConfig.start : lastDrawnAt[_beneficiary];
&nbsp;
        // Find out how much time has past since last invocation
        uint256 timePassedSinceLastInvocation = _getNow().sub(timeLastDrawn);
&nbsp;
        // Work out how many due tokens - time passed * rate per second
        uint256 amount = timePassedSinceLastInvocation.mul(schedule.drawDownRate);
&nbsp;
        return (amount, timeLastDrawn, schedule.drawDownRate);
    }
}
&nbsp;</pre></td></tr>
</table></pre>
<div class='push'></div><!-- for sticky footer -->
</div><!-- /wrapper -->
<div class='footer quiet pad2 space-top1 center small'>
  Code coverage
  generated by <a href="http://istanbul-js.org/" target="_blank">istanbul</a> at Mon Sep 07 2020 12:04:25 GMT+0100 (British Summer Time)
</div>
</div>
<script src="../prettify.js"></script>
<script>
window.onload = function () {
        if (typeof prettyPrint === 'function') {
            prettyPrint();
        }
};
</script>
<script src="../sorter.js"></script>
</body>
</html>
